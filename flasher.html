<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPVGate Web Flasher</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>FPVGate</h1>
            </div>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="docs.html">Documentation</a>
                <a href="flasher.html" class="btn-primary">Flash Firmware</a>
                <a href="https://github.com/LouisHitchcock/FPVGate" target="_blank">GitHub</a>
            </div>
        </div>
    </nav>

    <section class="flasher-section">
        <div class="container">
            <h1>FPVGate Web Flasher</h1>
            <p class="subtitle">Flash FPVGate firmware directly from your browser - no command line required!</p>

            <div class="alert alert-info" id="browser-warning" style="display: none;">
                <strong>Browser Not Supported!</strong> Please use Chrome, Edge, or Opera browser.
            </div>

            <div class="beta-mode-toggle">
                <label class="toggle-switch">
                    <input type="checkbox" id="beta-mode">
                    <span class="slider"></span>
                </label>
                <span class="toggle-label">Expert Mode</span>
            </div>

            <div class="flasher-container">
                <div class="flasher-main">
                    <div class="flasher-config">
                        <div class="form-group">
                            <label for="board-select">1. Select Your Board</label>
                            <select id="board-select" class="form-control">
                                <option value="">Choose your ESP32 board...</option>
                                <option value="esp32s3">ESP32-S3 DevKitC-1 (8MB Flash) - Recommended</option>
                                <option value="esp32s3supermini">ESP32-S3 Super Mini (4MB Flash)</option>
                            </select>
                            <small>Not sure which board you have? Check the <a href="https://github.com/LouisHitchcock/FPVGate/blob/main/docs/HARDWARE_GUIDE.md" target="_blank">Hardware Guide</a></small>
                        </div>

                        <div class="form-group">
                            <label for="version-select">2. Select Firmware Version</label>
                            <select id="version-select" class="form-control">
                                <option value="">Loading versions...</option>
                            </select>
                            <small id="version-info" class="version-info"></small>
                        </div>

                    <div id="custom-firmware-section" class="beta-only" style="display: none;">
                        <div class="form-group">
                            <label>Custom Firmware Upload:</label>
                            <div class="file-upload-group">
                                <button type="button" id="upload-firmware" class="btn btn-secondary btn-sm">Upload Firmware</button>
                                <button type="button" id="upload-filesystem" class="btn btn-secondary btn-sm">Upload Filesystem</button>
                            </div>
                            <input type="file" id="file-input" style="display: none;" accept=".bin">
                            <div id="uploaded-files" class="uploaded-files-list"></div>
                            <small>Upload custom .bin files to replace official firmware</small>
                        </div>
                    </div>

                        <div class="form-group">
                            <label>3. Flash Options</label>
                            
                            <div class="flash-option-item">
                                <div class="option-info">
                                    <span class="option-title">Full Chip Erase</span>
                                    <small>Erase all data before flashing (recommended for first-time setup)</small>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="erase-flash-toggle">
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="flash-option-item">
                                <div class="option-info">
                                    <span class="option-title">Verify After Flash</span>
                                    <small>Read back and verify written data (slower but safer)</small>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="verify-flash-toggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div id="flash-section" style="display: none;">
                            <div class="flash-ready-card">
                                <h3>4. Ready to Flash</h3>
                                <div class="flash-summary">
                                    <div class="summary-item">
                                        <span class="summary-label">Board:</span>
                                        <span id="selected-board" class="summary-value"></span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="summary-label">Version:</span>
                                        <span id="selected-version" class="summary-value"></span>
                                    </div>
                                </div>
                                <button id="connect-button" class="btn btn-large btn-primary btn-flash">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" style="margin-right: 8px;">
                                        <path d="M11 3L3 11h6l-1 7 8-8h-6l1-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Connect & Flash Device
                                </button>
                            </div>

                            <div id="flash-progress" class="flash-progress" style="display: none;">
                                <h4 id="progress-title">Connecting...</h4>
                                <div class="progress-bar-container">
                                    <div id="progress-bar" class="progress-bar"></div>
                                </div>
                                <p id="progress-status" class="progress-status"></p>
                                <div id="progress-log" class="progress-log"></div>
                            </div>

                            <div class="post-flash-actions" id="post-flash-actions" style="display: none;">
                                <h4>Flash Complete!</h4>
                                <p>Your device is ready. Connect to your FPVGate:</p>
                                <button id="open-device" class="btn btn-secondary">
                                    Open Device Interface
                                </button>
                                <small>Opens http://fpvgate.local or http://192.168.4.1</small>
                            </div>
                        </div>

                        <div id="loading-section" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>Preparing firmware...</p>
                        </div>

                        <div id="error-section" class="alert alert-error" style="display: none;">
                            <strong>Error:</strong> <span id="error-message"></span>
                        </div>
                    </div>
                </div>

                <div class="flasher-sidebar">
                    <div class="info-card">
                        <h3>Quick Tips</h3>
                        <ul>
                            <li>Connect your ESP32 via USB before starting</li>
                            <li>First time? Enable "Full Chip Erase"</li>
                            <li>Hold BOOT button if device isn't detected</li>
                            <li>Flashing takes 2-3 minutes</li>
                        </ul>
                    </div>

                    <div class="info-card">
                        <h3>After Flashing</h3>
                        <ol>
                            <li>Connect to WiFi: <strong>FPVGate_XXXX</strong></li>
                            <li>Password: <strong>fpvgate1</strong></li>
                            <li>Open <strong>fpvgate.local</strong></li>
                            <li>Configure your settings</li>
                        </ol>
                    </div>

                    <div class="info-card">
                        <h3>Helpful Links</h3>
                        <ul>
                            <li><a href="https://github.com/LouisHitchcock/FPVGate/blob/main/docs/GETTING_STARTED.md" target="_blank">Getting Started</a></li>
                            <li><a href="https://github.com/LouisHitchcock/FPVGate/blob/main/docs/HARDWARE_GUIDE.md" target="_blank">Hardware Guide</a></li>
                            <li><a href="https://github.com/LouisHitchcock/FPVGate/releases" target="_blank">Download Audio Files</a></li>
                            <li><a href="https://github.com/LouisHitchcock/FPVGate/issues" target="_blank">Report Issues</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>Made with care for the FPV community</p>
            <p>Licensed under CC BY-NC-SA 4.0</p>
        </div>
    </footer>

    <script src="flasher.js"></script>
</body>
</html>
